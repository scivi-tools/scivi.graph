<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>SciVi-CGraph</title>
        
        <script src="../lib/pixi.js"></script>
        <script src="../lib/jquery.min.js"></script>
        <script src="../lib/jquery-ui.min.js"></script>
        <script src="../lib/split.min.js"></script>
        <script src="../lib/louvain.min.js"></script>
        <script src="../lib/chart.min.js"></script>

        <link rel="stylesheet" href="../css/jquery-ui.css"/>
        <link rel="stylesheet" href="../css/default.css"/>

        <script src="data.js"></script>
        <script src="../css/colors.js"></script>
        <script src="../css/loc-ru.js"></script>
        <script src="../css/loc-en.js"></script>
        <script src="../lib/scivi-cgraph.min.js"></script>

        <script>
            function getParameterByName(name, url)
            {
                if (!url)
                    url = window.location.href;
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
                var results = regex.exec(url);
                if (!results)
                    return null;
                if (!results[2])
                    return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }

            function main()
            {
                var loc = getParameterByName("lang") === "ru" ? g_loc_ru : g_loc_en;

                var parser = new SciViCGraph.Parser(g_data);
                var renderer = new SciViCGraph.Renderer($('#view')[0], $('#info')[0],
                                                        $('#list')[0], $('#settings')[0],
                                                        $('#stats')[0], null,
                                                        loc);

                var g = parser.graphData;

                $("#lnk_info").text(loc["LOC_INFO"]);
                $("#lnk_list").text(loc["LOC_NODES"]);
                $("#lnk_settings").text(loc["LOC_SETTINGS"]);
                $("#lnk_stats").text(loc["LOC_GROUPS"]);

                Split(['#a', '#b'], {
                      gutterSize: 8,
                      cursor: 'col-resize',
                      onDrag: () => { renderer.reshape(); }
                });

                $("#tabs").tabs({heightStyle: "fill"});

                console.log("Number of nodes: " + g.nodes.length);
                console.log("Number of edges: " + g.edges.length);

                g.nodes.sort((x1, x2) => {
                    if (x1.custom["age"] < x2.custom["age"])
                        return -1;
                    else if (x1.custom["age"] > x2.custom["age"])
                        return 1;
                    else {
                        if (x1.custom["sex"] < x2.custom["sex"])
                            return -1;
                        else if (x1.custom["sex"] > x2.custom["sex"])
                            return 1;
                        else {
                            if (x1.custom["education"] < x2.custom["education"])
                                return -1;
                            else if (x1.custom["education"] > x2.custom["education"])
                                return 1;
                            else
                                return 0;
                        }
                    }
                });

                var textColors1 = [ 0xffffff, 0x000000 ];
                var colors1 = [ 0xdd1111, 0x5dc8cd ];
                var steps1 = [ 20, 30, 40, 50 ];
                var names1 = [ "< 20", "20 - 30", "30 - 40", "40 - 50", "> 50" ];
                var scale1 = new SciViCGraph.Scale(steps1, colors1, textColors1, names1, (node) => { return node.custom["age"]; });

                var textColors2 = [ 0x000000, 0xffffff ];
                var colors2 = [ 0xDEBB3C, 0x0371AB ];
                var steps2 = [ 0, 1 ];
                var names2 = [ "", loc["LOC_MALE"], loc["LOC_FEMALE"], "" ];
                var scale2 = new SciViCGraph.Scale(steps2, colors2, textColors2, names2, (node) => { return node.custom["sex"]; });

                var textColors3 = [ 0xffffff, 0xffffff ];
                var colors3 = [ 0x101010, 0xaa0000 ];
                var steps3 = [ 0, 1 ];
                var names3 = [ "", loc["LOC_EDUCATION_MIDDLE"], loc["LOC_EDUCATION_HIGH"], "" ];
                var scale3 = new SciViCGraph.Scale(steps3, colors3, textColors3, names3, (node) => { return node.custom["education"]; });

                renderer.setInput([ g ], g_colors);
                renderer.scaleLevels = [ scale3, scale2, scale1 ];
                renderer.run();
            }
        </script>
    </head>

    <body onload="main();">

        <div id="a" class="split split-horizontal">
            <div id="view"></div>
        </div>
        <div id="b" class="split split-horizontal">
            <div id="tabs">
                <ul>
                    <li><a id="lnk_info" href="#info"></a></li>
                    <li><a id="lnk_list" href="#list"></a></li>
                    <li><a id="lnk_settings" href="#settings"></a></li>
                    <li><a id="lnk_stats" href="#stats"></a></li>
                </ul>
                <div id="info"></div>
                <div id="list"></div>
                <div id="settings"></div>
                <div id="stats"></div>
            </div>
        </div>
        
    </body>
</html>
