(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Louvain=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){var Louvain={detectClusters:function(data){function createCommunityGraph(ngraph){var nodeCount=ngraph.getNodesCount();var weight=0;var nodes=[];var indexLookup=new Map;ngraph.forEachNode(function(node){initNode(node.id)});ngraph.forEachLink(function(link){var fromIdx=getNodeIdFromNgraph(link.fromId);var toIdx=getNodeIdFromNgraph(link.toId);var weight=getWeight(link.data);var fromNode=nodes[fromIdx];var toNode=nodes[toIdx];if(fromIdx===toIdx){fromNode.selfLoopsCount+=weight;fromNode.weightedDegree+=weight}else{addNeighbour(fromNode,toIdx,weight);addNeighbour(toNode,fromIdx,weight);fromNode.weightedDegree+=weight;toNode.weightedDegree+=weight}});weight=computeTotalWeight();return{nodeCount:nodeCount,weight:weight,forEachNeigbour:forEachNeigbour,getWeightedDegree:getWeightedDegree,getSelfLoopsCount:getSelfLoopsCount,getNodeIdFromNgraph:getNodeIdFromNgraph};function getNodeIdFromNgraph(id){var idx=indexLookup.get(id);if(idx===undefined)throw new Error("Unknown node id: "+id);return idx}function addNeighbour(node,id,weight){var info={id:id,weight:weight};if(!node.neighbours)node.neighbours=[info];else node.neighbours.push(info)}function forEachNeigbour(nodeId,cb){var node=getNode(nodeId);if(!node.neighbours)return;for(var i=0;i<node.neighbours.length;++i){var info=node.neighbours[i];cb(info.id,info.weight)}}function computeTotalWeight(){var weight=0;for(var i=0;i<nodeCount;++i){weight+=getWeightedDegree(i)}return weight}function getSelfLoopsCount(nodeId){return getNode(nodeId).selfLoopsCount}function getWeightedDegree(nodeId){return getNode(nodeId).weightedDegree}function getNode(nodeId){var node=nodes[nodeId];if(!node)throw new Error("cannot find node with id: "+nodeId);return node}function initNode(id){var node={selfLoopsCount:0,weightedDegree:0,neighbours:null};var idx=nodes.length;indexLookup.set(id,idx);nodes.push(node);return idx}}function getWeight(data){if(!data)return 1;if(typeof data==="number")return data;if(typeof data.weight==="number")return data.weight;return 1}function createCommunity(graph){var graphWeight=graph.weight;var nodeCount=graph.nodeCount;var totalLinksWeight=new Float32Array(nodeCount);var internalLinksWeight=new Float32Array(nodeCount);var nodeToCommunity=new Uint32Array(nodeCount);for(var i=0;i<nodeCount;++i){nodeToCommunity[i]=i;totalLinksWeight[i]=graph.getWeightedDegree(i);internalLinksWeight[i]=graph.getSelfLoopsCount(i)}return{modularity:modularity,optimizeModularity:optimizeModularity,getClass:getClass};function getClass(id){return nodeToCommunity[id]}function optimizeModularity(){var epsilon=1e-6;var iterator=getRandomNodeIdIterator();var newModularity=modularity();var currentModularity=newModularity;var modularityImproved=false;do{var movesCount=0;currentModularity=newModularity;for(var i=0;i<iterator.length;++i){var node=iterator[i];var nodeCommunity=nodeToCommunity[node];var neigboughingCommunities=getNeighbouringCommunities(node);var sharedLinksWeight=neigboughingCommunities.get(nodeCommunity);removeFromCommunity(node,nodeCommunity,sharedLinksWeight);var weightedDegree=graph.getWeightedDegree(node);var bestCommunity=nodeCommunity;var bestGain=0;neigboughingCommunities.forEach(function(sharedWeight,communityId){var gain=getModularityGain(node,sharedWeight,communityId,weightedDegree);if(gain<=bestGain)return;bestCommunity=communityId;bestGain=gain});var bestSharedWeight=neigboughingCommunities.get(bestCommunity);insertIntoCommunity(node,bestCommunity,bestSharedWeight);if(bestCommunity!==nodeCommunity)movesCount+=1}newModularity=modularity();if(movesCount>0)modularityImproved=true}while(movesCount>0&&newModularity-currentModularity>epsilon);return modularityImproved}function getNeighbouringCommunities(nodeId){var map=new Map;map.set(nodeToCommunity[nodeId],0);graph.forEachNeigbour(nodeId,function(otherNodeId,edgeWeight){var otherCommunity=nodeToCommunity[otherNodeId];var currentValue=map.get(otherCommunity)||0;map.set(otherCommunity,currentValue+edgeWeight)});return map}function getModularityGain(nodeId,sharedWeight,communityId,degree){var totalLinksWeightInThisCommunity=totalLinksWeight[communityId];return sharedWeight-totalLinksWeightInThisCommunity*degree/graphWeight}function removeFromCommunity(nodeId,communityId,sharedLinksWeight){totalLinksWeight[communityId]-=graph.getWeightedDegree(nodeId);internalLinksWeight[communityId]-=2*sharedLinksWeight+graph.getSelfLoopsCount(nodeId);nodeToCommunity[nodeId]=-1}function insertIntoCommunity(nodeId,communityId,sharedLinksWeight){totalLinksWeight[communityId]+=graph.getWeightedDegree(nodeId);internalLinksWeight[communityId]+=2*sharedLinksWeight+graph.getSelfLoopsCount(nodeId);nodeToCommunity[nodeId]=communityId}function modularity(){var result=0;for(var communityId=0;communityId<nodeCount;++communityId){if(totalLinksWeight[communityId]>0){var dw=totalLinksWeight[communityId]/graphWeight;result+=internalLinksWeight[communityId]/graphWeight-dw*dw}}return result}function getRandomNodeIdIterator(){var iterator=[];for(var i=0;i<nodeCount;++i){iterator[i]=i}var nrandom=require("ngraph.random");var seededRandom=nrandom.random(42);var randomIterator=nrandom.randomIterator;randomIterator(iterator,seededRandom).shuffle();return iterator}}function modularity(ngraph){var graph=createCommunityGraph(ngraph);var community=createCommunity(graph);var originalModularity=community.modularity();var nodesMoved=community.optimizeModularity();var newModularity=community.modularity();return{canCoarse:canCoarse,originalModularity:originalModularity,newModularity:newModularity,getClass:getClass};function canCoarse(){return nodesMoved}function getClass(nodeId){var node=graph.getNodeIdFromNgraph(nodeId);return community.getClass(node)}}var create=require("ngraph.graph");var detect=modularity;var graph=create();data.nodes.forEach(function(node){if(node.visible)graph.addNode(node.positionHash(),node)});data.edges.forEach(function(edge){if(edge.visible)graph.addLink(edge.source.positionHash(),edge.target.positionHash())});var clusters=detect(graph);var indices={};var index=0;graph.forEachNode(function(node){var classID=clusters.getClass(node.id);var groupID=indices[classID];if(groupID===undefined){groupID=index++;indices[classID]=groupID}node.data.groupID=groupID})}};module.exports=Louvain},{"ngraph.graph":3,"ngraph.random":4}],2:[function(require,module,exports){module.exports=function(subject){validateSubject(subject);var eventsStorage=createEventsStorage(subject);subject.on=eventsStorage.on;subject.off=eventsStorage.off;subject.fire=eventsStorage.fire;return subject};function createEventsStorage(subject){var registeredEvents=Object.create(null);return{on:function(eventName,callback,ctx){if(typeof callback!=="function"){throw new Error("callback is expected to be a function")}var handlers=registeredEvents[eventName];if(!handlers){handlers=registeredEvents[eventName]=[]}handlers.push({callback:callback,ctx:ctx});return subject},off:function(eventName,callback){var wantToRemoveAll=typeof eventName==="undefined";if(wantToRemoveAll){registeredEvents=Object.create(null);return subject}if(registeredEvents[eventName]){var deleteAllCallbacksForEvent=typeof callback!=="function";if(deleteAllCallbacksForEvent){delete registeredEvents[eventName]}else{var callbacks=registeredEvents[eventName];for(var i=0;i<callbacks.length;++i){if(callbacks[i].callback===callback){callbacks.splice(i,1)}}}}return subject},fire:function(eventName){var callbacks=registeredEvents[eventName];if(!callbacks){return subject}var fireArguments;if(arguments.length>1){fireArguments=Array.prototype.splice.call(arguments,1)}for(var i=0;i<callbacks.length;++i){var callbackInfo=callbacks[i];callbackInfo.callback.apply(callbackInfo.ctx,fireArguments)}return subject}}}function validateSubject(subject){if(!subject){throw new Error("Eventify cannot use falsy object as events subject")}var reservedWords=["on","fire","off"];for(var i=0;i<reservedWords.length;++i){if(subject.hasOwnProperty(reservedWords[i])){throw new Error("Subject cannot be eventified, since it already has property '"+reservedWords[i]+"'")}}}},{}],3:[function(require,module,exports){module.exports=createGraph;var eventify=require("ngraph.events");function createGraph(options){options=options||{};if("uniqueLinkId"in options){console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\n"+"Use `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now own each graph\n"+"is considered to be not a multigraph by default (each edge is unique).");options.multigraph=options.uniqueLinkId}if(options.multigraph===undefined)options.multigraph=false;var nodes=typeof Object.create==="function"?Object.create(null):{},links=[],multiEdges={},nodesCount=0,suspendEvents=0,forEachNode=createNodeIterator(),createLink=options.multigraph?createUniqueLink:createSingleLink,changes=[],recordLinkChange=noop,recordNodeChange=noop,enterModification=noop,exitModification=noop;var graphPart={addNode:addNode,addLink:addLink,removeLink:removeLink,removeNode:removeNode,getNode:getNode,getNodesCount:function(){return nodesCount},getLinksCount:function(){return links.length},getLinks:getLinks,forEachNode:forEachNode,forEachLinkedNode:forEachLinkedNode,forEachLink:forEachLink,beginUpdate:enterModification,endUpdate:exitModification,clear:clear,hasLink:getLink,hasNode:getNode,getLink:getLink};eventify(graphPart);monitorSubscribers();return graphPart;function monitorSubscribers(){var realOn=graphPart.on;graphPart.on=on;function on(){graphPart.beginUpdate=enterModification=enterModificationReal;graphPart.endUpdate=exitModification=exitModificationReal;recordLinkChange=recordLinkChangeReal;recordNodeChange=recordNodeChangeReal;graphPart.on=realOn;return realOn.apply(graphPart,arguments)}}function recordLinkChangeReal(link,changeType){changes.push({link:link,changeType:changeType})}function recordNodeChangeReal(node,changeType){changes.push({node:node,changeType:changeType})}function addNode(nodeId,data){if(nodeId===undefined){throw new Error("Invalid node identifier")}enterModification();var node=getNode(nodeId);if(!node){node=new Node(nodeId,data);nodesCount++;recordNodeChange(node,"add")}else{node.data=data;recordNodeChange(node,"update")}nodes[nodeId]=node;exitModification();return node}function getNode(nodeId){return nodes[nodeId]}function removeNode(nodeId){var node=getNode(nodeId);if(!node){return false}enterModification();var prevLinks=node.links;if(prevLinks){node.links=null;for(var i=0;i<prevLinks.length;++i){removeLink(prevLinks[i])}}delete nodes[nodeId];nodesCount--;recordNodeChange(node,"remove");exitModification();return true}function addLink(fromId,toId,data){enterModification();var fromNode=getNode(fromId)||addNode(fromId);var toNode=getNode(toId)||addNode(toId);var link=createLink(fromId,toId,data);links.push(link);addLinkToNode(fromNode,link);if(fromId!==toId){addLinkToNode(toNode,link)}recordLinkChange(link,"add");exitModification();return link}function createSingleLink(fromId,toId,data){var linkId=makeLinkId(fromId,toId);return new Link(fromId,toId,data,linkId)}function createUniqueLink(fromId,toId,data){var linkId=makeLinkId(fromId,toId);var isMultiEdge=multiEdges.hasOwnProperty(linkId);if(isMultiEdge||getLink(fromId,toId)){if(!isMultiEdge){multiEdges[linkId]=0}var suffix="@"+ ++multiEdges[linkId];linkId=makeLinkId(fromId+suffix,toId+suffix)}return new Link(fromId,toId,data,linkId)}function getLinks(nodeId){var node=getNode(nodeId);return node?node.links:null}function removeLink(link){if(!link){return false}var idx=indexOfElementInArray(link,links);if(idx<0){return false}enterModification();links.splice(idx,1);var fromNode=getNode(link.fromId);var toNode=getNode(link.toId);if(fromNode){idx=indexOfElementInArray(link,fromNode.links);if(idx>=0){fromNode.links.splice(idx,1)}}if(toNode){idx=indexOfElementInArray(link,toNode.links);if(idx>=0){toNode.links.splice(idx,1)}}recordLinkChange(link,"remove");exitModification();return true}function getLink(fromNodeId,toNodeId){var node=getNode(fromNodeId),i;if(!node||!node.links){return null}for(i=0;i<node.links.length;++i){var link=node.links[i];if(link.fromId===fromNodeId&&link.toId===toNodeId){return link}}return null}function clear(){enterModification();forEachNode(function(node){removeNode(node.id)});exitModification()}function forEachLink(callback){var i,length;if(typeof callback==="function"){for(i=0,length=links.length;i<length;++i){callback(links[i])}}}function forEachLinkedNode(nodeId,callback,oriented){var node=getNode(nodeId);if(node&&node.links&&typeof callback==="function"){if(oriented){return forEachOrientedLink(node.links,nodeId,callback)}else{return forEachNonOrientedLink(node.links,nodeId,callback)}}}function forEachNonOrientedLink(links,nodeId,callback){var quitFast;for(var i=0;i<links.length;++i){var link=links[i];var linkedNodeId=link.fromId===nodeId?link.toId:link.fromId;quitFast=callback(nodes[linkedNodeId],link);if(quitFast){return true}}}function forEachOrientedLink(links,nodeId,callback){var quitFast;for(var i=0;i<links.length;++i){var link=links[i];if(link.fromId===nodeId){quitFast=callback(nodes[link.toId],link);if(quitFast){return true}}}}function noop(){}function enterModificationReal(){suspendEvents+=1}function exitModificationReal(){suspendEvents-=1;if(suspendEvents===0&&changes.length>0){graphPart.fire("changed",changes);changes.length=0}}function createNodeIterator(){return Object.keys?objectKeysIterator:forInIterator}function objectKeysIterator(callback){if(typeof callback!=="function"){return}var keys=Object.keys(nodes);for(var i=0;i<keys.length;++i){if(callback(nodes[keys[i]])){return true}}}function forInIterator(callback){if(typeof callback!=="function"){return}var node;for(node in nodes){if(callback(nodes[node])){return true}}}}function indexOfElementInArray(element,array){if(!array)return-1;if(array.indexOf){return array.indexOf(element)}var len=array.length,i;for(i=0;i<len;i+=1){if(array[i]===element){return i}}return-1}function Node(id,data){this.id=id;this.links=null;this.data=data}function addLinkToNode(node,link){if(node.links){node.links.push(link)}else{node.links=[link]}}function Link(fromId,toId,data,id){this.fromId=fromId;this.toId=toId;this.data=data;this.id=id}function hashCode(str){var hash=0,i,chr,len;if(str.length==0)return hash;for(i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0}return hash}function makeLinkId(fromId,toId){return fromId.toString()+"👉 "+toId.toString()}},{"ngraph.events":2}],4:[function(require,module,exports){module.exports={random:random,randomIterator:randomIterator};function random(inputSeed){var seed=typeof inputSeed==="number"?inputSeed:+new Date;var randomFunc=function(){seed=seed+2127912214+(seed<<12)&4294967295;seed=(seed^3345072700^seed>>>19)&4294967295;seed=seed+374761393+(seed<<5)&4294967295;seed=(seed+3550635116^seed<<9)&4294967295;seed=seed+4251993797+(seed<<3)&4294967295;seed=(seed^3042594569^seed>>>16)&4294967295;return(seed&268435455)/268435456};return{next:function(maxValue){return Math.floor(randomFunc()*maxValue)},nextDouble:function(){return randomFunc()}}}function randomIterator(array,customRandom){var localRandom=customRandom||random();if(typeof localRandom.next!=="function"){throw new Error("customRandom does not match expected API: next() function is missing")}return{forEach:function(callback){var i,j,t;for(i=array.length-1;i>0;--i){j=localRandom.next(i+1);t=array[j];array[j]=array[i];array[i]=t;callback(t)}if(array.length){callback(array[0])}},shuffle:function(){var i,j,t;for(i=array.length-1;i>0;--i){j=localRandom.next(i+1);t=array[j];array[j]=array[i];array[i]=t}return array}}}},{}]},{},[1])(1)});